(function () {
  "use strict";

  var cfg = {
    defaultLanguage: {{ element_classic_default_language | to_json }},
    hideSignup: {{ element_classic_hide_signup | bool | to_json }},
    hideForgotPassword: {{ element_classic_hide_forgot_password | bool | to_json }}
  };

  function localeCandidates(raw) {
    var value = (raw || "").trim();
    if (!value) return [];

    var parts = value.split(/[-_]/);
    var base = (parts[0] || "").toLowerCase();
    var region = (parts[1] || "").toUpperCase();

    var list = [];
    function push(v) {
      if (!v) return;
      if (list.indexOf(v) === -1) list.push(v);
    }

    if (base && region) {
      push(base + "_" + region);
      push(base + "-" + region);
      push(base + "-" + region.toLowerCase());
      push(base + "_" + region.toLowerCase());
    }
    push(value);
    push(value.replace(/-/g, "_"));
    push(value.replace(/_/g, "-"));
    if (base) push(base);
    return list;
  }

  var languages = localeCandidates(cfg.defaultLanguage);
  var preferredLanguage = languages.length ? languages[0] : "";

  function setLocalSettingsLanguage() {
    if (!preferredLanguage) return false;

    var changed = false;

    try {
      var currentRaw = localStorage.getItem("mx_local_settings");
      var current = currentRaw ? JSON.parse(currentRaw) : {};
      if (typeof current !== "object" || current === null) current = {};
      if (current.language !== preferredLanguage) {
        current.language = preferredLanguage;
        localStorage.setItem("mx_local_settings", JSON.stringify(current));
        changed = true;
      }
    } catch (err) {
      // Ignore storage/JSON failures and continue.
    }

    try {
      if (localStorage.getItem("language") !== preferredLanguage) {
        localStorage.setItem("language", preferredLanguage);
        changed = true;
      }
      if (localStorage.getItem("mx_language") !== preferredLanguage) {
        localStorage.setItem("mx_language", preferredLanguage);
        changed = true;
      }
      if (localStorage.getItem("i18nextLng") !== preferredLanguage) {
        localStorage.setItem("i18nextLng", preferredLanguage);
        changed = true;
      }
    } catch (err2) {
      // Ignore storage issues.
    }

    return changed;
  }

  function ensureLoginHashLang() {
    if (!preferredLanguage) return;

    var hash = window.location.hash || "";
    if (!hash.startsWith("#/login")) return;
    if (hash.indexOf("lang=") !== -1) return;

    var sep = hash.indexOf("?") === -1 ? "?" : "&";
    var next = hash + sep + "lang=" + encodeURIComponent(preferredLanguage);
    window.history.replaceState(null, "", window.location.pathname + window.location.search + next);
  }

  function lowerText(el) {
    return ((el && el.textContent) || "").toLowerCase().trim();
  }

  function hideElement(el) {
    if (!el) return;
    var container = el.closest(".mx_AuthBody, .mx_AuthBody_login, .mx_Login_start, .mx_AuthPage, .mx_Field, .mx_FormButton, p, div") || el;
    container.style.setProperty("display", "none", "important");
    el.style.setProperty("display", "none", "important");
    el.setAttribute("aria-hidden", "true");
    el.setAttribute("tabindex", "-1");
  }

  function containsAny(value, needles) {
    if (!value) return false;
    for (var i = 0; i < needles.length; i += 1) {
      if (value.indexOf(needles[i]) !== -1) return true;
    }
    return false;
  }

  function shouldHideSignup(el) {
    if (!cfg.hideSignup) return false;
    var href = (el.getAttribute("href") || "").toLowerCase();
    var text = lowerText(el);
    return containsAny(href, ["register", "signup", "sign-up"]) ||
      containsAny(text, ["create account", "create an account", "sign up", "signup", "criar conta", "crie uma conta", "cadastre", "registrar"]);
  }

  function shouldHideForgotPassword(el) {
    if (!cfg.hideForgotPassword) return false;
    var href = (el.getAttribute("href") || "").toLowerCase();
    var text = lowerText(el);
    return containsAny(href, ["forgot", "reset-password", "reset_password", "recover"]) ||
      containsAny(text, ["forgot password", "forgotten password", "reset password", "esqueci", "redefinir senha", "recuperar senha"]);
  }

  function applyUiTweaks() {
    setLocalSettingsLanguage();
    ensureLoginHashLang();

    var candidates = document.querySelectorAll("a, button, [role='button']");
    for (var i = 0; i < candidates.length; i += 1) {
      var el = candidates[i];
      if (shouldHideSignup(el) || shouldHideForgotPassword(el)) {
        hideElement(el);
      }
    }
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", applyUiTweaks);
  } else {
    applyUiTweaks();
  }

  window.addEventListener("hashchange", applyUiTweaks);
  window.setInterval(applyUiTweaks, 2000);

  var observer = new MutationObserver(applyUiTweaks);
  observer.observe(document.documentElement, { childList: true, subtree: true });
})();
